この章では、LiteCoreカーネルで実装されているメモリ管理（フレーム割当、メモリマップ、カーネルヒープ）の設計と使い方を記述します

## 概要
LiteCoreはメモリ管理を次の要素で提供します。

- memmap: 物理メモリフレームの管理情報を保持する構造体（`memmap_t`）。
- bitmap: フレーム割当を実装するためのビットマップ（1 ビット = 1 フレーム）。
- frame allocator: ビットマップを使ったフレーム単位（通常 4KiB）の割当/解放。
- kernel heap: カーネル内での動的メモリアロケータ（簡易 free-list, `kmalloc`/`kfree`）。

これらは `src/kernel/mem/` と `src/include/mem/` 以下に実装されています。

## メモリレイアウトとinit
起動時に以下を行います。

1. `memmap_init(start_addr, end_addr)` を呼んで memmap と bitmap を初期化します。
	 - `start_addr` / `end_addr` はフレーム割当の扱う物理領域を表します（例: 0x100000 - 0x500000）。
2. カーネルのバイナリ領域の終端はリンカシンボル `__end` で参照できます。
3. ヒープ開始 (`heap_start`) は次のルールで安全に決定します:
	 - `heap_start` = max(`&__end`, `bitmap_end`) を取り、ページ（4KiB）境界に切り上げる。
	 - これにより静的領域（`memmap` や `bitmap`）とヒープ領域の重複を防ぎます。
4. `mem_init(heap_start, heap_end)` を呼んでカーネルヒープを初期化します。
5. `memmap_reserve(heap_start, heap_end)` でヒープ領域に対応するフレームをmemmap上で予約（割当不可）にします。

## `memmap_t` とビットマップ
`memmap_t` は次の情報を持ちます（実装に依存しますが概念は以下の通りです）：

- `start_addr`: 管理領域の先頭アドレス
- `end_addr`: 管理領域の末尾アドレス
- `start_frame`: 管理領域に対応する最初のフレーム番号
- `max_frames`: 管理可能なフレーム数
- `bitmap`: ビットマップの先頭（バイト単位）

ビットマップは1ビット = 1フレームを表し、0が空き、1が使用中を示します。

## カーネルヒープ（free-list）
ヒープは簡易的な free-list ベースのアロケータです。実装の要点:

- 各ブロックはヘッダを持ち、サイズと使用フラグを保持します。
- アラインは 8 バイト（または実装上の要件）で揃えます。
- `kmalloc(size)` は最初に見つかった十分な大きさのフリーブロックを分割して返します。
- `kfree(ptr)` は隣接するフリーブロックとマージ（coalesce）します。
- 仮実装であり、スレッドセーフではありません。

## TASK
- ヒープのスレッドセーフ化（スピンロック等）
- フレーム割当で連続フレームを高速に割当できるように最適化
- ページテーブル / 仮想メモリの導入後に、物理フレームと仮想アドレス空間の管理を分離
