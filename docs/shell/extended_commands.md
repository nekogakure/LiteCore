この章では、拡張シェルコマンドについて記述します。
実装されているファイルは[extended_commands.c](https://github.com/nekogakure/LiteCore/blob/main/src/kernel/shell/extended_commands.c)です。

## 概要
システムの機能にアクセスするための拡張コマンド群を提供します。メモリ情報、ファイルシステム操作、デバイス情報、システム情報などの実用的なコマンドを含みます。

## 関数 / API

#### `void register_extended_commands(void)`
すべての拡張コマンドをコマンドシステムに登録します。以下のコマンドを登録します：
- mem: メモリ情報の表示
- ls: ディレクトリ内容の一覧
- cat: ファイル内容の表示
- ver: バージョン情報の表示
- uptime: システム稼働時間の表示
- cd: ディレクトリの変更
- pwd: 現在のディレクトリパスの表示
- devices: 接続デバイスの一覧

引数: なし

## 定数 / 定義

このファイルには定数定義はありません。

## 構造体

このファイルには公開構造体の定義はありません。

## 実装されているコマンド

### mem
メモリ使用状況を表示します。物理フレームマップとカーネルヒープの統計を表示します。
- 物理フレーム: 総数、使用数、空き数（MB単位）
- カーネルヒープ: 総容量、空き容量、最大空きブロック（KB単位）

### ls
現在のディレクトリの内容を一覧表示します。ext2ファイルシステムがマウントされている必要があります。ファイル名、サイズ、タイプ（FILE/DIR）を表示します。

### cat
ファイルの内容を表示します。引数としてファイル名を指定します。
```
cat <filename>
```

### ver
カーネルのバージョン情報を表示します。バージョン番号、ビルド日時、作者を表示します。

### uptime
システムの稼働時間を表示します。APIC Timerを使用して経過時間をミリ秒単位で表示します。

### cd
現在のディレクトリを変更します。相対パスと絶対パスをサポートします。
```
cd <path>
```
特殊なパス:
- `.`: 現在のディレクトリ（変更なし）
- `..`: 親ディレクトリへ移動
- `/`: ルートディレクトリへ移動

### pwd
現在のディレクトリパスを表示します。

### devices
接続されているPCIデバイスを一覧表示します。`-v`オプションで詳細情報を表示します。
```
devices      # 簡易表示
devices -v   # 詳細表示（クラスコード、ベンダーID、デバイスID）
```

## 実装の詳細

### グローバル変数
- `current_dir_inode`: 現在のディレクトリのinode番号（デフォルトはルート=2）
- `current_path`: 現在のディレクトリパス（最大256文字）

### ext2ファイルシステム統合
ls、cat、cdコマンドは、グローバル変数`g_ext2_sb`（main.cで定義）を使用してext2ファイルシステムにアクセスします。ファイルシステムがマウントされていない場合、エラーメッセージを表示します。

### パス解決
cdコマンドは、相対パスと絶対パスの両方を解釈します。`/`で始まるパスは絶対パス、それ以外は相対パスとして扱います。パスコンポーネントを順に解決し、各ディレクトリのinodeを取得します。

### メモリ統計
memコマンドは、物理フレームマップとヒープ統計の両方を表示します。整数演算を使用して小数点以下2桁のMB/KB表示を実現しています。

### デバイス列挙
devicesコマンドは、PCIデバイススキャン機能を使用してバス上のデバイスを検出します。各デバイスのクラス、ベンダー、デバイスIDを表示します。
